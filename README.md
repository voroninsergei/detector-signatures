# Детектор подписей

Проект «Детектор подписей» реализует автоматизацию методик судебно‑почерковедческой экспертизы по книгам В. Ф. Орловой. Его назначение — предоставить экспертам в удобном виде детерминистские алгоритмы для анализа рукописных текстов и подписей без привлечения машинного обучения.

## Архитектура

Проект построен модульно. В пакете `modules` каждый файл отражает разделы «особенной части» учебника. В дальнейшем в этих модулях будут реализованы соответствующие алгоритмы.

* `preprocessing.py` — функции чтения изображений, приведения к оттенкам серого, бинаризации, фильтрации шума, выравнивания и сегментации;
* `basic_analysis.py` — общие признаки почерка (степень выработанности, размер букв, наклон, разгоны, связность);
* `digital.py` — исследование цифрового почерка;
* `time_gap.py` — анализ устойчивости признаков при разрыве во времени;
* `similar_handwriting.py` — сравнение сходных почерков;
* `unusual_conditions.py` — письмо в необычных условиях;
* `intentional_change.py` — умышленное изменение (маскировка) почерка;
* `left_hand.py` — письмо левой рукой;
* `print_like.py` — имитация печатного шрифта;
* `imitation.py` — подражание чужому почерку;
* `personality_diagnosis.py` — вероятностное определение пола, возраста и психологических особенностей.
* `general_features.py` — вычисление статистических признаков (размер, наклон, связность и др.), используемых в сравнительном анализе;
* `comparative.py` — модуль для расчёта коэффициента сходства между образцами.

Дополнительный пакет `generator` отвечает за формирование экспертного заключения.

Веб‑интерфейс реализован на Flask в файле `app.py`. Пользователь загружает изображение, выбирает тип анализа, и приложение вызывает соответствующий модуль. Для генерации отчёта планируется использовать `python-docx`.

Начиная с этапа 7 в репозитории имеется модуль `generator/docx_generator.py`,
который позволяет формировать файл DOCX на основе результатов анализов.  Он
принимает структуру данных с текстовыми блоками, таблицами и иллюстрациями
и автоматически создает документ со стандартными разделами: «Вводные
данные», «Методика и ход исследования», «Результаты сравнительного
исследования», «Диагностические выводы», «Заключение» и «Иллюстрации».

Пример использования:

```python
from signature_detector.generator import generate_conclusion

data = {
    'intro': 'Объект исследования – подписи на договоре ...',
    'methodology': 'Для исследования использовали методы ...',
    'comparative_analysis': 'В ходе сравнения выявлено ...',
    'diagnostic': 'Диагностические признаки указывают на ...',
    'conclusion': 'Изученные подписи принадлежат одному лицу.',
    'images': ['path/to/processed_image.png'],
    'tables': [[['Признак', 'Образец 1', 'Образец 2'], ['Размер', '3.1', '3.0']]]
}

generate_conclusion(data, 'expert_report.docx')
```

## Запуск

Установите зависимости и запустите приложение:

```bash
pip install -r requirements.txt
python app.py
```

После запуска приложение будет доступно по адресу `http://localhost:5000`.

## Тестирование (этап 8)

В проекте предусмотрён набор модульных тестов (см. каталог
`signature_detector/tests`), проверяющих основные компоненты системы:
предобработку изображений, расчёт общих признаков, сравнение образцов
и генерацию отчёта.  Тесты основаны на синтетических данных и
используют `pytest`.

Запуск тестов:

```bash
pytest -q signature_detector/tests
```

Если все тесты проходят успешно, базовая функциональность проекта
считается работоспособной.  В дальнейшем при добавлении новых
методик рекомендуется расширять набор тестов.

## Структура

```
signature_detector/
├── app.py
├── modules/
│   ├── __init__.py
│   ├── preprocessing.py
│   ├── basic_analysis.py
│   ├── digital.py
│   ├── time_gap.py
│   ├── similar_handwriting.py
│   ├── unusual_conditions.py
│   ├── intentional_change.py
│   ├── left_hand.py
│   ├── print_like.py
│   ├── imitation.py
│   └── personality_diagnosis.py
├── requirements.txt
└── README.md
```